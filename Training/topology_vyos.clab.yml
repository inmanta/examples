name: training
mgmt:
  network: inmanta_mgmt
  ipv4_subnet: 10.0.0.0/24
topology:
  nodes:
    R1:
      kind: linux
      image: vyos:1.2
      mgmt_ipv4: 10.0.0.5
      cmd: /sbin/init
      binds:
        - /lib/modules:/lib/modules
        - ./resources/R1/config:/opt/vyatta/etc/config/
    C1:
      kind: linux
      image: praqma/network-multitool:latest
      mgmt_ipv4: 10.0.0.205
      cmd: bash /opt/config_ip 10.0.1.2/24 eth1 10.0.1.1
      binds:
        - ./resources/Clients/:/opt/
    R2:
      kind: linux
      image: vyos:1.2
      mgmt_ipv4: 10.0.0.6
      cmd: /sbin/init
      binds:
        - /lib/modules:/lib/modules
        - ./resources/R2/config:/opt/vyatta/etc/config/
    C2:
      kind: linux
      image: praqma/network-multitool:latest
      mgmt_ipv4: 10.0.0.206
      cmd: bash /opt/config_ip 10.0.2.2/24 eth1 10.0.2.1
      binds:
        - ./resources/Clients/:/opt/
    R3:
      kind: linux
      image: vyos:1.2
      mgmt_ipv4: 10.0.0.7
      cmd: /sbin/init
      binds:
        - /lib/modules:/lib/modules
        - ./resources/R3/config:/opt/vyatta/etc/config/
    C3:
      kind: linux
      image: praqma/network-multitool:latest
      mgmt_ipv4: 10.0.0.207
      cmd: bash /opt/config_ip 10.0.3.2/24 eth1 10.0.3.1
      binds:
        - ./resources/Clients/:/opt/
    R4:
      kind: linux
      image: vyos:1.2
      mgmt_ipv4: 10.0.0.8
      cmd: /sbin/init
      binds:
        - /lib/modules:/lib/modules
        - ./resources/R4/config:/opt/vyatta/etc/config/
    C4:
      kind: linux
      image: praqma/network-multitool:latest
      mgmt_ipv4: 10.0.0.208
      cmd: bash /opt/config_ip 10.0.4.2/24 eth1 10.0.4.1
      binds:
        - ./resources/Clients/:/opt/
    pgmaster:
      kind: linux
      image: postgres:14
      env:
        POSTGRES_USER: inmanta
        POSTGRES_PASSWORD: inmanta
      mgmt_ipv4: 10.0.0.100
    orchestrator:
      kind: linux
      image: ghcr.io/inmanta/orchestrator:latest
      binds:
        - ./resources/inmanta.cfg:/etc/inmanta/inmanta.cfg
      cmd: server --wait-for-host clab-training-pgmaster --wait-for-port 5432
      mgmt_ipv4: 10.0.0.102
  links:
    - endpoints: ["R1:eth1", "R2:eth1"]
    - endpoints: ["R1:eth2", "R3:eth1"]
    - endpoints: ["R1:eth3", "R4:eth1"]
    - endpoints: ["R2:eth2", "R3:eth2"]
    - endpoints: ["R2:eth3", "R4:eth2"]
    - endpoints: ["R3:eth3", "R4:eth3"]
    - endpoints: ["C1:eth1", "R1:eth4"]
    - endpoints: ["C2:eth1", "R2:eth4"]
    - endpoints: ["C3:eth1", "R3:eth4"]
    - endpoints: ["C4:eth1", "R4:eth4"]
